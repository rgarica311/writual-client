(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,2738,e=>{"use strict";var t=e.i(13609);let i=t.gql`
  query GetProjectScenes($input: ProjectFilters) {
    getProjectData(input: $input) {
      _id
      scenes {
        number
        activeVersion
        lockedVersion
        projectId
        versions {
          act
          antithesis
          step
          synopsis
          synthesis
          thesis
          version
          sceneHeading
        }
      }
    }
  }
`;e.s(["PROJECT_SCENES_QUERY",0,i])},48296,(e,t,i)=>{function r(e,t=100,i={}){let n,s,a,o,l;if("function"!=typeof e)throw TypeError(`Expected the first parameter to be a function, got \`${typeof e}\`.`);if(t<0)throw RangeError("`wait` must not be negative.");let{immediate:c}="boolean"==typeof i?{immediate:i}:i;function d(){let t=n,i=s;return n=void 0,s=void 0,l=e.apply(t,i)}function p(){let e=Date.now()-o;e<t&&e>=0?a=setTimeout(p,t-e):(a=void 0,c||(l=d()))}let u=function(...e){if(n&&this!==n&&Object.getPrototypeOf(this)===Object.getPrototypeOf(n))throw Error("Debounced method called with different contexts of the same prototype.");n=this,s=e,o=Date.now();let i=c&&!a;return a||(a=setTimeout(p,t)),i&&(l=d()),l};return Object.defineProperty(u,"isPending",{get:()=>void 0!==a}),u.clear=()=>{a&&(clearTimeout(a),a=void 0)},u.flush=()=>{a&&u.trigger()},u.trigger=()=>{l=d(),u.clear()},u}t.exports.debounce=r,t.exports=r},16455,2718,3376,96974,e=>{"use strict";e.i(91077);var t=e.i(48296),i=e.i(10570);e.s(["useDebounce",0,e=>{let r=(0,i.useRef)(null);return(0,i.useEffect)(()=>{r.current=e},[e]),(0,i.useMemo)((...e)=>(0,t.default)((...e)=>{r.current?.(...e)},1e3),[])}],2718);var r=e.i(38240),n=e.i(98340),s=e.i(13609);let a=s.gql`
  mutation CreateScene(
    $versions: [SceneContentInput]
    $_id: String
  ) {
    createScene(
      input: {
        _id: $_id
        versions: $versions
      }
    ) {
      number
    }
  }
`,o=s.gql`
  mutation UpdateScene(
    $_id: String!
    $number: Int
    $activeVersion: Int
    $lockedVersion: Int
    $newVersion: Boolean
    $newScene: Boolean
    $versions: [SceneContentInput]
  ) {
    createScene(
      input: {
        _id: $_id
        number: $number
        activeVersion: $activeVersion
        lockedVersion: $lockedVersion
        newVersion: $newVersion
        newScene: $newScene
        versions: $versions
      }
    ) {
      number
    }
  }
`;e.s(["CREATE_SCENE",0,a,"UPDATE_SCENE",0,o],3376);let l=s.gql`
  mutation DeleteScene($projectId: String!, $sceneNumber: Int!) {
    deleteScene(projectId: $projectId, sceneNumber: $sceneNumber) {
      id
      scenes {
        number
      }
    }
  }
`;var c=e.i(82125);let d="project-scenes";function p(){let e=(0,n.useQueryClient)(),t=(0,r.useMutation)({mutationFn:async e=>(0,s.request)(c.GRAPHQL_ENDPOINT,o,{_id:e._id,number:e.number,activeVersion:e.activeVersion,lockedVersion:e.lockedVersion??void 0,newVersion:e.newVersion,newScene:!1,versions:e.versions}),onSuccess:(t,i)=>{i._id&&e.invalidateQueries({queryKey:[d,i._id]})}});return{updateSceneMutation:t,deleteSceneMutation:(0,r.useMutation)({mutationFn:async e=>(0,s.request)(c.GRAPHQL_ENDPOINT,l,{projectId:e._id,sceneNumber:e.number}),onSuccess:(t,i)=>{i._id&&e.invalidateQueries({queryKey:[d,i._id]})}}),createSceneMutation:(0,r.useMutation)({mutationFn:async e=>(0,s.request)(c.GRAPHQL_ENDPOINT,a,{_id:e._id,versions:e.versions,number:e.number}),onSuccess:(t,i)=>{i._id&&e.invalidateQueries({queryKey:[d,i._id]})}})}}e.s(["PROJECT_SCENES_QUERY_KEY",0,d,"useProjectSceneMutations",()=>p],96974),e.s([],16455)},20744,e=>{"use strict";var t=e.i(18506),i=e.i(10570),r=e.i(4135),n=e.i(5391),s=e.i(54383),a=e.i(85131),o=e.i(66896),l=e.i(55371),c=e.i(13609);e.i(44332);var d=e.i(69359),p=e.i(43087),u=e.i(98799);e.i(26504);var h=e.i(28323),m=e.i(80930);e.i(45493);var x=e.i(7284),g=e.i(13266),v=e.i(66933),f=e.i(81865),y=e.i(75377),b=e.i(77111);let w=(0,v.styled)("div",{name:"MuiDivider",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:i}=e;return[t.root,i.absolute&&t.absolute,t[i.variant],i.light&&t.light,"vertical"===i.orientation&&t.vertical,i.flexItem&&t.flexItem,i.children&&t.withChildren,i.children&&"vertical"===i.orientation&&t.withChildrenVertical,"right"===i.textAlign&&"vertical"!==i.orientation&&t.textAlignRight,"left"===i.textAlign&&"vertical"!==i.orientation&&t.textAlignLeft]}})((0,f.default)(({theme:e})=>({margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(e.vars||e).palette.divider,borderBottomWidth:"thin",variants:[{props:{absolute:!0},style:{position:"absolute",bottom:0,left:0,width:"100%"}},{props:{light:!0},style:{borderColor:e.alpha((e.vars||e).palette.divider,.08)}},{props:{variant:"inset"},style:{marginLeft:72}},{props:{variant:"middle",orientation:"horizontal"},style:{marginLeft:e.spacing(2),marginRight:e.spacing(2)}},{props:{variant:"middle",orientation:"vertical"},style:{marginTop:e.spacing(1),marginBottom:e.spacing(1)}},{props:{orientation:"vertical"},style:{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"}},{props:{flexItem:!0},style:{alignSelf:"stretch",height:"auto"}},{props:({ownerState:e})=>!!e.children,style:{display:"flex",textAlign:"center",border:0,borderTopStyle:"solid",borderLeftStyle:"solid","&::before, &::after":{content:'""',alignSelf:"center"}}},{props:({ownerState:e})=>e.children&&"vertical"!==e.orientation,style:{"&::before, &::after":{width:"100%",borderTop:`thin solid ${(e.vars||e).palette.divider}`,borderTopStyle:"inherit"}}},{props:({ownerState:e})=>"vertical"===e.orientation&&e.children,style:{flexDirection:"column","&::before, &::after":{height:"100%",borderLeft:`thin solid ${(e.vars||e).palette.divider}`,borderLeftStyle:"inherit"}}},{props:({ownerState:e})=>"right"===e.textAlign&&"vertical"!==e.orientation,style:{"&::before":{width:"90%"},"&::after":{width:"10%"}}},{props:({ownerState:e})=>"left"===e.textAlign&&"vertical"!==e.orientation,style:{"&::before":{width:"10%"},"&::after":{width:"90%"}}}]}))),j=(0,v.styled)("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(e,t)=>{let{ownerState:i}=e;return[t.wrapper,"vertical"===i.orientation&&t.wrapperVertical]}})((0,f.default)(({theme:e})=>({display:"inline-block",paddingLeft:`calc(${e.spacing(1)} * 1.2)`,paddingRight:`calc(${e.spacing(1)} * 1.2)`,whiteSpace:"nowrap",variants:[{props:{orientation:"vertical"},style:{paddingTop:`calc(${e.spacing(1)} * 1.2)`,paddingBottom:`calc(${e.spacing(1)} * 1.2)`}}]}))),S=i.forwardRef(function(e,i){let r=(0,y.useDefaultProps)({props:e,name:"MuiDivider"}),{absolute:n=!1,children:s,className:a,orientation:o="horizontal",component:l=s||"vertical"===o?"div":"hr",flexItem:c=!1,light:d=!1,role:p="hr"!==l?"separator":void 0,textAlign:u="center",variant:h="fullWidth",...m}=r,v={...r,absolute:n,component:l,flexItem:c,light:d,orientation:o,role:p,textAlign:u,variant:h},f=(e=>{let{absolute:t,children:i,classes:r,flexItem:n,light:s,orientation:a,textAlign:o,variant:l}=e;return(0,g.default)({root:["root",t&&"absolute",l,s&&"light","vertical"===a&&"vertical",n&&"flexItem",i&&"withChildren",i&&"vertical"===a&&"withChildrenVertical","right"===o&&"vertical"!==a&&"textAlignRight","left"===o&&"vertical"!==a&&"textAlignLeft"],wrapper:["wrapper","vertical"===a&&"wrapperVertical"]},b.getDividerUtilityClass,r)})(v);return(0,t.jsx)(w,{as:l,className:(0,x.default)(f.root,a),role:p,ref:i,ownerState:v,"aria-orientation":"separator"===p&&("hr"!==l||"vertical"===o)?o:void 0,...m,children:s?(0,t.jsx)(j,{className:f.wrapper,ownerState:v,children:s}):null})});S&&(S.muiSkipListHighlight=!0);var C=e.i(38201),T=e.i(37564),V=e.i(39134),E=e.i(28117),_=e.i(28208),k=e.i(37217),I=e.i(74836);let R=(0,I.default)((0,t.jsx)("path",{d:"M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m6-9h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h1.9c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m0 12H6V10h12z"}),"LockOpen"),$=(0,I.default)((0,t.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1z"}),"Lock");var P=e.i(17280),M=e.i(45050);e.i(16455);var B=e.i(96974);let A={overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:4,WebkitBoxOrient:"vertical"},W=({number:e,newScene:n=!1,versions:s,activeVersion:o,lockedVersion:l,act:c,projectId:d,step:x,onDelete:g})=>{let v=Math.max(1,Number(o??1)),[f,y]=(0,i.useState)(v),[b,w]=(0,i.useState)(!1),[j,I]=(0,i.useState)({thesis:"",antithesis:"",synthesis:"",synopsis:"",sceneHeading:""}),W=(0,i.useRef)(null),D=(0,i.useRef)({}),N=(0,i.useRef)({version:v,newVersion:!1}),H=(0,i.useRef)(s??[]),{updateSceneMutation:z,deleteSceneMutation:O}=(0,B.useProjectSceneMutations)(),L=(0,k.useTheme)(),[q,Q]=(0,i.useState)(null!=l);(0,i.useEffect)(()=>{H.current=Array.isArray(s)?s:[]},[s]),(0,i.useEffect)(()=>{y(Math.max(1,Number(o??1)))},[o]),(0,i.useEffect)(()=>{Q(null!=l)},[l]),(0,i.useEffect)(()=>{if(b)return void I({thesis:"",antithesis:"",synthesis:"",synopsis:"",sceneHeading:""});let e=Math.max(0,f-1),t=H.current[e]??H.current[0];I({version:t?.version??f,thesis:t?.thesis??"",antithesis:t?.antithesis??"",synthesis:t?.synthesis??"",synopsis:t?.synopsis??"",sceneHeading:t?.sceneHeading??"",step:t?.step??x??"",act:t?.act??c??void 0})},[f,b,x,c,s]),(0,i.useEffect)(()=>{D.current=j},[j]),(0,i.useEffect)(()=>()=>{W.current&&clearTimeout(W.current)},[]);let F=t=>i=>{let r=i.target.value;I(e=>({...e,[t]:r})),q||!d||(N.current={version:f||1,newVersion:b},W.current&&clearTimeout(W.current),W.current=setTimeout(()=>{W.current=null;let t=D.current,{version:i,newVersion:r}=N.current,n=Math.max(0,i-1),s={...H.current[n]??{},thesis:t.thesis??"",antithesis:t.antithesis??"",synthesis:t.synthesis??"",sceneHeading:t.sceneHeading??"",synopsis:t.synopsis??"",step:t.step??"",act:t.act??void 0,version:i};z.mutate({_id:d,number:e,activeVersion:i,newVersion:r,versions:[s]},{onSuccess:()=>{r&&w(!1)}})},2e3))},U=(Array.isArray(s)?s.length:0)+ +!!b,K=(0,i.useMemo)(()=>Array.from({length:Math.max(1,U)},(e,t)=>t+1),[U]),Y=String(f);return(0,t.jsxs)(p.default,{sx:{...h.sceneCardStyle.card,backgroundColor:L.palette.background.paper,display:"flex",flexDirection:"column"},children:[(0,t.jsxs)(r.Box,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:1,px:2,py:1.5},children:[(0,t.jsx)(r.Box,{sx:{display:"flex",alignItems:"center",gap:1,minWidth:220,flex:1},children:q?(0,t.jsx)(a.Typography,{variant:"subtitle1",fontWeight:700,component:"span",sx:A,children:j.sceneHeading?.trim()||"Untitled scene"}):(0,t.jsx)(_.TextField,{size:"small",value:j.sceneHeading??"",onChange:F("sceneHeading"),placeholder:"Scene heading",variant:"outlined",sx:{minWidth:200,flex:1,"& .MuiInputBase-input":{py:.5}}})}),(0,t.jsxs)(r.Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,t.jsx)(m.Chip,{label:`#${e}`,size:"small",sx:{backgroundColor:L.palette.grey[600],color:L.palette.common.white,fontWeight:600}}),(0,t.jsx)(m.Chip,{label:`v${f}`,size:"small",sx:{backgroundColor:L.palette.grey[300],color:L.palette.text.primary,fontWeight:600}})]})]}),(0,t.jsx)(S,{}),(0,t.jsx)(u.default,{sx:{flex:"0 1 auto",height:175,overflowY:"auto",p:1,px:2,"&:last-child":{pb:1.5}},children:(0,t.jsxs)(r.Box,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,t.jsxs)(r.Box,{children:[(0,t.jsx)(a.Typography,{component:"span",fontWeight:700,sx:{display:"block",mb:.25},variant:"body2",children:"Thesis:"}),q?(0,t.jsx)(a.Typography,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:j.thesis?.trim()||"—"}):(0,t.jsx)(_.TextField,{fullWidth:!0,size:"small",multiline:!0,minRows:2,maxRows:4,value:j.thesis??"",onChange:F("thesis"),placeholder:"—",variant:"outlined",sx:{"& .MuiInputBase-input":{py:.5}}})]}),(0,t.jsxs)(r.Box,{children:[(0,t.jsx)(a.Typography,{component:"span",fontWeight:700,sx:{display:"block",mb:.25},variant:"body2",children:"Antithesis:"}),q?(0,t.jsx)(a.Typography,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:j.antithesis?.trim()||"—"}):(0,t.jsx)(_.TextField,{fullWidth:!0,size:"small",multiline:!0,minRows:2,maxRows:4,value:j.antithesis??"",onChange:F("antithesis"),placeholder:"—",variant:"outlined",sx:{"& .MuiInputBase-input":{py:.5}}})]}),(0,t.jsxs)(r.Box,{children:[(0,t.jsx)(a.Typography,{component:"span",fontWeight:700,sx:{display:"block",mb:.25},variant:"body2",children:"Synthesis:"}),q?(0,t.jsx)(a.Typography,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:j.synthesis?.trim()||"—"}):(0,t.jsx)(_.TextField,{fullWidth:!0,size:"small",multiline:!0,minRows:2,maxRows:4,value:j.synthesis??"",onChange:F("synthesis"),placeholder:"—",variant:"outlined",sx:{"& .MuiInputBase-input":{py:.5}}})]})]})}),(0,t.jsx)(S,{}),(0,t.jsxs)(r.Box,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:1,minHeight:30,px:2,py:1.5,flexShrink:0},children:[(0,t.jsx)(T.IconButton,{size:"small",onClick:t=>{if(t.preventDefault(),t.stopPropagation(),!d)return;let i=q?null:f;Q(!q);let r=Math.max(0,f-1),n=H.current[r]??{};z.mutate({_id:d,number:e,activeVersion:f,lockedVersion:i??void 0,newVersion:!1,versions:[n]})},sx:{backgroundColor:q?L.palette.primary.main:L.palette.grey[200],color:q?L.palette.primary.contrastText??L.palette.common.white:L.palette.grey[700],"&:hover":{backgroundColor:q?L.palette.primary.dark:L.palette.grey[300]}},"aria-label":q?"Unlock scene":"Lock scene",children:q?(0,t.jsx)($,{fontSize:"small"}):(0,t.jsx)(R,{fontSize:"small"})}),(0,t.jsxs)(r.Box,{sx:{display:"flex",alignItems:"center",gap:1,flex:1,justifyContent:"center"},children:[(0,t.jsx)(C.FormControl,{size:"small",sx:{minWidth:140},children:(0,t.jsx)(E.Select,{value:Y,onChange:t=>{if(q)return;let i=parseInt(t.target.value,10);if(Number.isFinite(i)&&!(i<1)&&(w(!1),y(i),d)){let t=Math.max(0,i-1),r=H.current[t]??{};z.mutate({_id:d,number:e,activeVersion:i,newVersion:!1,versions:[r]})}},disabled:q,displayEmpty:!0,sx:{backgroundColor:L.palette.grey[100],borderRadius:1,fontSize:"0.875rem","& .MuiSelect-select":{py:.75}},renderValue:e=>`v${e} (Active)`,children:K.map(e=>(0,t.jsxs)(V.MenuItem,{value:String(e),children:["v",e,b&&e===K.length?" (New)":""]},e))})}),(0,t.jsx)(T.IconButton,{size:"small",onClick:t=>{if(t.preventDefault(),t.stopPropagation(),q||!d)return;W.current&&(clearTimeout(W.current),W.current=null);let i=(Array.isArray(s)?s.length:0)+1;w(!0),y(i),z.mutate({_id:d,number:e,activeVersion:i,newVersion:!0,versions:[{version:i,sceneHeading:"",thesis:"",antithesis:"",synthesis:"",synopsis:"",step:x??"",act:c??void 0}]},{onSuccess:()=>{w(!1)}})},disabled:q,"aria-label":"Add new version",sx:{backgroundColor:L.palette.primary.light,color:L.palette.primary.contrastText??L.palette.common.white,"&:hover":{backgroundColor:L.palette.primary.main}},children:(0,t.jsx)(M.default,{fontSize:"small"})})]}),(0,t.jsx)(T.IconButton,{size:"small",onClick:()=>{d&&O.mutate({_id:d,number:e},{onSuccess:()=>g?.()})},sx:{backgroundColor:L.palette.error.light,color:L.palette.error.contrastText??L.palette.common.white,"&:hover":{backgroundColor:L.palette.error.main}},"aria-label":"Delete scene",children:(0,t.jsx)(P.default,{fontSize:"small"})})]})]})};var D=e.i(2738);let N=e.i(82125).GRAPHQL_ENDPOINT,H={version:1,sceneHeading:"",thesis:"",antithesis:"",synthesis:"",synopsis:"",act:1};function z(){let e=(0,o.useParams)(),p=e?.id,{createSceneMutation:u}=(0,B.useProjectSceneMutations)(),h=i.useMemo(()=>({input:{user:"rory.garcia1@gmail.com",_id:p}}),[p]),{data:m}=(0,l.useQuery)({queryKey:[B.PROJECT_SCENES_QUERY_KEY,p],queryFn:()=>(0,c.request)(N,D.PROJECT_SCENES_QUERY,h),enabled:!!p}),x=m?.getProjectData?.[0]?.scenes??[];return(0,t.jsxs)(s.Container,{maxWidth:!1,disableGutters:!0,sx:{border:"1px solid green",display:"flex",flexDirection:"column",flex:1,padding:2,height:"100%",width:"100%"},children:[(0,t.jsx)(d.ProjectHeader,{}),(0,t.jsxs)(s.Container,{maxWidth:!1,disableGutters:!0,sx:{minHeight:"500px",width:"100%",paddingTop:2},children:[(0,t.jsxs)(r.Box,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:1,mb:2},children:[(0,t.jsx)(a.Typography,{variant:"h6",fontWeight:600,children:"Outline"}),(0,t.jsx)(n.Button,{variant:"contained",color:"primary",size:"small",startIcon:(0,t.jsx)(M.default,{}),onClick:()=>{p&&u.mutate({_id:p,number:x.length+1,versions:[{...H}]})},disabled:u.isPending,children:"New scene"})]}),(0,t.jsx)(r.Box,{sx:{height:"calc(100% - 45px)",display:"flex",flexDirection:"row",flexWrap:"wrap",overflowY:"scroll",gap:2},children:x.map((e,i)=>{let r=e.activeVersion??1,n=Math.max(0,r-1),s=e.versions?.[n];return(0,t.jsx)(W,{number:e.number,newScene:!1,versions:e.versions??[],activeVersion:r,lockedVersion:e.lockedVersion??null,projectId:e.projectId??p,step:s?.step??""},e.number??i)})})]})]})}e.s(["default",()=>z],20744)}]);